2012年5月25日21:06:43
acg游戏其实就是一个互动幻灯片
我们借用电影剧本的术语来组织其结构
幕
场景
节拍

从一个最简单的人物对话场景开始，我们需要
背景
角色立绘(头像、半身像，全身像都有可能)
对话框
	能够以一定速度逐字显示对白，显示完后提示用户点击鼠标（或者做出某些动作）继续
通过影片剪辑的帧来组织画面，镜头，角色的切换。
通过xml来配置对白。

2012年9月11日
---ova系统---
	活用flash的时间轴编辑功能
	背景
	角色立绘	是一个或者根据情况拆成多个mc，可以在mc类定位中定义一些动画标签常量
	对话框
		顺序显示文字，显示过程中点击鼠标完成文字显示，再点击显示下一段文字
	角色头像	每个角色的头像集合是一个mc，可以在mc类定位中定义一些动画标签常量
		用在对话框中，表示说话者。也可以展示说话者的表情
	对白
	选项框
	UI
	背景乐
	特效音
	
	
	结构
		幕
		序列
		场景
		节拍

2012-10-13
选项框
	1 弹出选项框时，用户可以照常说(多段)对白，但全部说完后不可以点击跳过，必须等待玩家选择一个答案才可继续。
	2 
	
	
2013-7-6
用电影剧术语来指导程序设计也许不是个好主意。讨论剧情设计时我们使用幕，序列，场景，节拍，而回到程序我们只有MovieClip用作基本组织单元
接下来的任务就是如何设计一些胶水代码把这些MovieClip组织在一起

MovieClip可以做很多事，我们今天的设计需求是
	
	对话头像
	对话框
		顺序显示文字，显示过程中在画面上任何位置点击鼠标马上显示当前对白的所有文字，当前对白结束后显示结束提示符。此时再(在画面上任何位置标)点击鼠标则执行下一个游戏动作，比如显示下一段对白，或者切换到下一场景，或者弹出个对话框什么的
	立绘
	背景层
	
	效果音
	背景音乐	

----关键实现思路----

尽可能让编辑人员不用接触代码

对白编辑
	在外部xml中配置对白文本
	在帧脚本上定义该帧要显示的对白
	在flashIDE舞台上直接编辑对白	√ 最直观	先用此办法
		为了方便，我添加了一些代码允许编辑者在一帧内输入多段对白，用特殊符号进行分割，暂定是"|"。每进入一帧会自动读取舞台上写好的台词，并按照"|"符号分段，每次播放一段，播完最后一段之后进入下一帧，可以在下一帧的脚本中执行后继操作。
		* 因为是要从舞台上读取台词，所以这些代码必须是场景级别的。所以我们的场景都要继承自一个基类，这个基类实现了一些场景的通用功能
		
		
对话头像
	用程控方式更换头像		
		好处是比如可以和对话框封装在一起，实现共同控制，比如位移，渐变等特效
		缺点是要弄程序代码
	用ide编辑更换头像		√ 先用此办法
		好处是编辑方式最直观，不用弄程序代码
		缺点是意味着对话头像没法封装成一个通用mc，没法和对话框封装在一起，而他们看上去很适合封装成同一个组件（因为封装成mc的话，在ide里更换头像图片实际上是在编辑mc的资源定义，而不是在运行时更换图片）
		所以，以下效果不容易实现：对话框和头像一起移动，一起渐变等

2013-7-10
	我需要实现一个功能，每次切换Frame时，gotoAndPlay(),或者next()，都要先调用某个函数
	解决的办法想到了两个
	1 是用addFrameScript这个功能，我没有用过，官方文档里也没有它，可能是个禁忌的api，而且它确实可能会导致代码不清晰，我不打算用这个办法
	2 是MovieClip没有切换Frame的相关事件，只能在EnterFrame事件中比较上一帧号与新帧号来判断是否切换了Frame，是的话就调用目标函数。之前就是这么实心的，这次重新考虑了一下貌似也没有比这更好的思路
	
	另外还在考虑，如果一段对白字数太多，对白框里显示不下了该怎么办好呢？
	1 控制对白字数，让他能显示下	√ 这个办法最省事
	2 对白框出现滚动条	x 感觉对用户不友好
	3 对白框始终滚动到文字的结尾处，就像《love plus》那样	x 感觉还是不够友好
	
2013-7-15
	我有个想法，何必再额外弄一个对白编辑框？干嘛不让编辑直接修改每帧的对白框内容就好了呢？ 
	
2013-7-16
	先从简单的制作开始，不显示小头像，只用角色名称来显示，就像心跳回忆
	
2013-7-20 
	删除每句对白开头和末尾的回车符号， 用正则表达式
	
2013-7-21
	动态文本框在ide中设置字距不管用，那就只好在脚本中设置了
	
2013-7-25
	如何添加转场效果，我有以下几个方案
	1 在主时间轴上直接制作补间动画
		优点	比较直观？
		缺点	
			导致时间轴变得臃肿不清晰
			与其他图层耦合很大，调整补间动画的帧数时还需要移动其他图层的时间轴，比较麻烦，要求使用者很熟悉时间轴、关键帧操作
		
	2 把转场补间封装到mc中	√ 选用此办法
		* 实现的过程中学习了一些东西
			某mc的时间轴脚本只能调用该mc的类定义中的public属性和方法（貌似不包括setter和getter函数）
		优点 
			比起做法1，时间轴比较简洁，只需要一个关键帧
		缺点
			需要添加一些脚本，转场mc需要在播放结束时调度结束事件，场景mc需要在播放转场那一帧上hold住播放，然后侦听到转场mc的结束事件后，unhold播放并进入下一帧。
			
		总的来说，这种做法要添加的脚本在很多其他场合也用的到，比如插播一段mc动画（转场本身就是一段动画）
		
	3 用脚本调用转场补间
		还没有尝试，想了一下，引入了太多的脚本，有违项目初衷，故暂时不用这个做法
		
	4 用脚本制作转场特效
		还没有尝试，想了一下，引入了太多的脚本，有违项目初衷，故暂时不用这个做法
	
	* 把名称和对白图层合并，会更加方便编辑
	
2013-7-28
	因为帧脚本可能会修改显示内容，因此它应该在这一帧绘制之前执行，貌似是这样的
	而且貌似帧脚本会在onEnterFrame事件之前执行，这也是合理的。
	那么onEnterFrame是在帧绘制之前还是绘制之后发生的呢？
	
	执行nextFrame貌似会跳过剩余帧脚本
	
	关于播放控制，一开始我的思路是这样的，场景播放头总是停止的，由脚本来控制它逐帧渐进，并且在需要的时候使用_isHold标记来让播放头停留下来。
	现在想了想，貌似搞的有点复杂了，打算重新设计一下，初步思路如下：
		场景播放头默认是play状态，播放过程中遇到需要停止的帧时才会停止。
		需要停止的帧包括但不限于
			当前帧上有手动台词需要播放
			当前正在播放一段子动画，父场景需要暂停等待
			其他一些需要停止播放的情形，比如弹出选择框，等待用户的选择和指令。
		在这些需要停止的帧上手动加一行stop()语句即可，然后根据业务设计用play继续播放即可；但是播放手动台词几乎每帧都会出现，一一加stop很麻烦，因此要做成自动化的：每进入新的一帧时都要检查是否有手动台词，有的话就stop（对应的，自动台词可能要随着动画切换，不需要stop）
		
		* 尝试了一下，用play()替换nextFrame遇到了一个诡异的问题：每隔一帧在onEnterFrame事件里会取不到舞台上dh的文本内容(dh==null)，而用nextFrame就不会出问题。flashcs6的bug？
		* 为毛没有手动台词的时候要自动播放下一帧啊？ 影片由可能在做其他需要暂停的事，总的来说，我感觉应该是默认播放头每帧都停，然后每帧会根据自己的需求决定什么时候nextFrame
		* 发现_isHold不能取消，有用途，比如要实现这么个功能： 手动台词播放完了之后不nextFrame... 这时需要hold功能；用stop, play功能不好实现
		* 发现直接在对白显示框里输入台词也有问题，在一开始或者刚播放了一个空白台词帧，进入下一帧后，新台词会闪动一下才会被抹掉重新逐字播放
		
	修改
	合并名称和对白图层
	删除头像和遮罩层
	所有帧都是默认stop，每个帧根据自己的需求决定什么时候nextFrame；没有手动台词的帧也默认stop，不再自动nextFrame
	恢复了对白编辑框，解决对白闪动问题
	
	接下来可以考虑做选项，或者是加入语音对白
	
2013-7-30
	在考虑加入语音的时候遇到了一些问题...现在的做法里我支持在一帧之上录入多段连续的对白，但是貌似时间轴上一帧之内没法设置连续的声音。
	意味着没法使用纯ide的方式给（一帧之内）多段对白一一配上多段语音
	要么在帧脚本上把该帧要播放的对白文件组织到一个数组里然后配合着对白来播放；要么放弃在一帧上录入多段对白，只一帧一段对白
	另外一件事是如何实现提前结束一段对白时，如果对应的语音还没播放完该怎么办。思路有两个
	1 是终止模式，强行停止还在播放的语音文件。这个怎么实现我还不太清除，需要看一看as3的声音播放部分
	2 是重叠模式，不管还在播放的语音文件，哪怕它会和接下来的语音重叠播放。不是完美的解决方案，但我认为用户体验还可以接受。
	目前我认为不必追求细节的完美，先使用第2种办法继续推进即可。	
	
	
	